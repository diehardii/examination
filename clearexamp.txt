

CREATE TABLE examinai.userDetail
(
    user_id bigint PRIMARY KEY,
    identity_id varchar(20) null,
    gender varchar(4) null,
    email varchar(50) null,
    address varchar(50) null,
    university_id int null,
    department_id int null,
    occupation varchar(10) null,
    real_name varch(50) null,
    FOREIGN KEY (user_id) REFERENCES examinai.users (id),
    FOREIGN KEY (university_id) REFERENCES examinai.university (university_id),
    FOREIGN KEY (department_id) REFERENCES examinai.department (department_id)
);

create table examinai.exam_paper
(
    id                         bigint auto_increment
        primary key,
    exam_paper_content         varchar(255) null,
    exam_paper_difficulty      varchar(255) null,
    exam_paper_name            varchar(255) null,
    exam_paper_question_number int          not null,
    exam_paper_subject         varchar(255) null
);



create table examinai.exam_paper_subject
(
    id   bigint auto_increment
        primary key,
    name varchar(255) null,
    constraint UKj2c42cou2ias7dwe8hso2gk1q
        unique (name)
);

create table examinai.user_exam_paper
(
    id            bigint auto_increment
        primary key,
    exam_paper_id bigint       null,
    username      varchar(255) null,
    constraint FKrc0jkhn2itdd06u0bvdcq5lh4
        foreign key (exam_paper_id) references examinai.exam_paper (id),
    constraint fk_user_exam_paper_exam_paper_id
        foreign key (exam_paper_id) references examinai.exam_paper (id)
);

create table examinai.user_test_record
(
    test_id        bigint auto_increment
        primary key,
    correct_number int         not null,
    test_score     int         not null,
    test_time      datetime(6) null,
    exam_paper_id  bigint      null,
    user_id        bigint      null,
    constraint FK48e04bj0tfmk4nve3a9bhm8y2
        foreign key (user_id) references examinai.users (id),
    constraint FKqvg9t1cjs292pmssydsxc7w4b
        foreign key (exam_paper_id) references examinai.exam_paper (id)
);

create table examinai.user_test_record_detail
(
    id              bigint auto_increment
        primary key,
    correct_answer  varchar(255) null,
    question_number int          not null,
    question_type   varchar(255) null,
    user_answer     varchar(255) null,
    test_id         bigint       null,
    constraint FKsirtu6x98fbuaqm9o0gcyrjl4
        foreign key (test_id) references examinai.user_test_record (test_id)
);

create table examinai.question
(
    question_type  varchar(31)  not null,
    id             bigint auto_increment
        primary key,
    content        varchar(255) null,
    type           varchar(255) null,
    correct_answer varchar(255) null,
    optiona        varchar(255) null,
    optionb        varchar(255) null,
    optionc        varchar(255) null,
    optiond        varchar(255) null,
    exam_paper_id  bigint       null,
    number         int          not null,
    constraint FKce16uxg6lo4l7q1kjdkkl985p
        foreign key (exam_paper_id) references examinai.exam_paper (id)
);



试卷
package seucxxy.csd.backend.entity;
import java.util.List;
public class ExamPaper {
    private Long id;
    private String examPaperName;
    private String examPaperContent;
    private String examPaperDifficulty;
    private int examPaperQuestionNumber;
    private String examPaperSubject;
    private List<Question> questions;

    // Getters and Setters
    public Long getId() {
        return id;
    }

    public void setId(Long id) {
        this.id = id;
    }

    public String getExamPaperName() {
        return examPaperName;
    }

    public void setExamPaperName(String examPaperName) {
        this.examPaperName = examPaperName;
    }

    public String getExamPaperContent() {
        return examPaperContent;
    }

    public void setExamPaperContent(String examPaperContent) {
        this.examPaperContent = examPaperContent;
    }

    public String getExamPaperDifficulty() {
        return examPaperDifficulty;
    }

    public void setExamPaperDifficulty(String examPaperDifficulty) {
        this.examPaperDifficulty = examPaperDifficulty;
    }

    public int getExamPaperQuestionNumber() {
        return examPaperQuestionNumber;
    }

    public void setExamPaperQuestionNumber(int examPaperQuestionNumber) {
        this.examPaperQuestionNumber = examPaperQuestionNumber;
    }

    public String getExamPaperSubject() {
        return examPaperSubject;
    }

    public void setExamPaperSubject(String examPaperSubject) {
        this.examPaperSubject = examPaperSubject;
    }

    public List<Question> getQuestions() {
        return questions;
    }

    public void setQuestions(List<Question> questions) {
        this.questions = questions;
    }
}
题目
package seucxxy.csd.backend.entity;



public class Question {
    private Long id;
    private String questionType; // 新增字段，对应数据库question_type
    private String type;
    private String content;
    private int number;
    private Long examPaperId;
    private String correctAnswer; // 移动到基类

    // Getters and Setters
    // 添加questionType的getter/setter
    public String getQuestionType() {
        return questionType;
    }

    public void setQuestionType(String questionType) {
        this.questionType = questionType;
    }

    // Getters and Setters
    public Long getId() {
        return id;
    }

    public void setId(Long id) {
        this.id = id;
    }

    public String getType() {
        return type;
    }

    public void setType(String type) {
        this.type = type;
    }

    public String getContent() {
        return content;
    }

    public void setContent(String content) {
        this.content = content;
    }

    public int getNumber() {
        return number;
    }

    public void setNumber(int number) {
        this.number = number;
    }

    public Long getExamPaperId() {
        return examPaperId;
    }

    public void setExamPaperId(Long examPaperId) {
        this.examPaperId = examPaperId;
    }


    public String getCorrectAnswer() {
        return correctAnswer;
    }

    public void setCorrectAnswer(String correctAnswer) {
        this.correctAnswer = correctAnswer;
    }
}
单选题
package seucxxy.csd.backend.entity;



public class SingleChoiceQuestion extends Question {
    private String optionA;
    private String optionB;
    private String optionC;
    private String optionD;


    // Getters and Setters
    public String getOptionA() {
        return optionA;
    }

    public void setOptionA(String optionA) {
        this.optionA = optionA;
    }

    public String getOptionB() {
        return optionB;
    }

    public void setOptionB(String optionB) {
        this.optionB = optionB;
    }

    public String getOptionC() {
        return optionC;
    }

    public void setOptionC(String optionC) {
        this.optionC = optionC;
    }

    public String getOptionD() {
        return optionD;
    }

    public void setOptionD(String optionD) {
        this.optionD = optionD;
    }

}
判断题
package seucxxy.csd.backend.entity;



public class JudgeQuestion extends Question {



}

用户所有的试卷
package seucxxy.csd.backend.entity;


public class UserExamPaper {
    private Long id;
    private Long examPaperId;
    private String username;

    // Getters and Setters
    public Long getId() {
        return id;
    }

    public void setId(Long id) {
        this.id = id;
    }

    public Long getExamPaperId() {
        return examPaperId;
    }

    public void setExamPaperId(Long examPaperId) {
        this.examPaperId = examPaperId;
    }

    public String getUsername() {
        return username;
    }

    public void setUsername(String username) {
        this.username = username;
    }
}

用户考试记录
package seucxxy.csd.backend.entity;



import java.time.LocalDateTime;

public class UserTestRecord {
    private Long testId;
    private int correctNumber;
    private int testScore;
    private LocalDateTime testTime;
    private Long examPaperId;
    private Long userId;

    private ExamPaper examPaper;
    // Getters and Setters
    public Long getTestId() {
        return testId;
    }

    public void setTestId(Long testId) {
        this.testId = testId;
    }

    public int getCorrectNumber() {
        return correctNumber;
    }

    public void setCorrectNumber(int correctNumber) {
        this.correctNumber = correctNumber;
    }

    public int getTestScore() {
        return testScore;
    }

    public void setTestScore(int testScore) {
        this.testScore = testScore;
    }

    public LocalDateTime getTestTime() {
        return testTime;
    }

    public void setTestTime(LocalDateTime testTime) {
        this.testTime = testTime;
    }

    public Long getExamPaperId() {
        return examPaperId;
    }

    public void setExamPaperId(Long examPaperId) {
        this.examPaperId = examPaperId;
    }

    public Long getUserId() {
        return userId;
    }

    public void setUserId(Long userId) {
        this.userId = userId;
    }

    // 新增的ExamPaper getter和setter
    public ExamPaper getExamPaper() {
        return examPaper;
    }

    public void setExamPaper(ExamPaper examPaper) {
        this.examPaper = examPaper;
    }
}
用户考试记录详情
package seucxxy.csd.backend.entity;




public class UserTestRecordDetail {
    private Long id;
    private String correctAnswer;
    private int questionNumber;
    private String questionType;
    private String userAnswer;
    private Long testId;

    // Getters and Setters
    public Long getId() {
        return id;
    }

    public void setId(Long id) {
        this.id = id;
    }

    public String getCorrectAnswer() {
        return correctAnswer;
    }

    public void setCorrectAnswer(String correctAnswer) {
        this.correctAnswer = correctAnswer;
    }

    public int getQuestionNumber() {
        return questionNumber;
    }

    public void setQuestionNumber(int questionNumber) {
        this.questionNumber = questionNumber;
    }

    public String getQuestionType() {
        return questionType;
    }
    public void setQuestionType(String questionType) {
        this.questionType = questionType;
    }

    public String getUserAnswer() {
        return userAnswer;
    }
    public void setUserAnswer(String userAnswer) {
        this.userAnswer = userAnswer;
    }

    public Long getTestId() {
        return testId;
    }
    public void setTestId(Long testId) {
        this.testId= testId;
    }

}

package seucxxy.csd.backend.entity;


public class Subject {
    private int subjectId;
    private String subjectName;

    // Getters and Setters
    public Subject(String subjectName) {
        this.subjectName = subjectName;
    }

    public int getSubjectId() {
        return subjectId;
    }

    public void setSubjectId(int subjectId) {
        this.subjectId = subjectId;
    }

    public String getSubjectName() {
        return subjectName;
    }


用户实体
package seucxxy.csd.backend.entity;

import lombok.Data;

@Data
public class User {
    private Long  id;
    private String username;
    private String phone;
    private String password;
    private Integer roleId;


    private Role role;
    // 必须显式添加getRole()方法（即使使用@Data注解）
    public Role getRole() {
        if (this.role == null) {
            this.role = new Role(); // 防止NPE
        }
        return this.role;
    }
    // 显式setter确保数据同步
    public void setRole(Role role) {
        this.role = role;
        if (role != null) {
            this.roleId = role.getRoleId();
        }
    }
}

用户试卷关系实体
package seucxxy.csd.backend.entity;


public class UserExamPaper {
    private Long id;
    private Long examPaperId;
    private String username;

    // Getters and Setters
    public Long getId() {
        return id;
    }

    public void setId(Long id) {
        this.id = id;
    }

    public Long getExamPaperId() {
        return examPaperId;
    }

    public void setExamPaperId(Long examPaperId) {
        this.examPaperId = examPaperId;
    }

    public String getUsername() {
        return username;
    }

    public void setUsername(String username) {
        this.username = username;
    }
}
package seucxxy.csd.backend.controller;

试题分析网页
<template>
  <div class="app-container">
    <SideBarMenu />
    <div class="main-content">
      <div class="content">
        <div class="card">
          <div class="header-container">
            <h1 class="header">请选择你要分析的题目</h1>
          </div>

          <div class="analysis-container">
            <div class="analysis-section left-section">
              <h3 class="sticky-title">考试记录</h3>
              <div class="record-list fixed-height">
                <table id="examRecordsTable">
                  <thead>
                  <tr>
                    <th>试卷名称</th>
                    <th>考试时间</th>
                    <th>得分</th>
                  </tr>
                  </thead>
                  <tbody>
                  <tr v-for="(record, index) in userTestRecords"
                      :key="record.testId"
                      @click="handleExamRecordSelect(record, $event)"
                      :class="{ 'highlight': (index === 0 && !selectedTestRecord) ||
                                          (selectedTestRecord && record.testId === selectedTestRecord.testId) }">
                    <td>{{ record.examPaper.examPaperName }}</td>
                    <td>{{ formatDateTime(record.testTime) }}</td>
                    <td>{{ record.testScore }}</td>
                  </tr>
                  </tbody>
                </table>
              </div>
            </div>

            <div class="analysis-section right-section">
              <h3 class="sticky-title">题目详情</h3>
              <div class="question-list fixed-height">
                <div class="table-wrapper">
                  <table id="questionDetailsTable">
                    <thead>
                    <tr>
                      <th width="60px">题号</th>
                      <th>题目</th>
                      <th width="80px">用户答案</th>
                      <th width="80px">正确答案</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr v-for="(question, index) in questionsWithAnswers"
                        :key="question.number"
                        @click="handleQuestionSelect(question, $event)"
                        :class="{ 'highlight': (index === 0 && !selectedQuestion && questionsWithAnswers.length > 0) ||
                                            (selectedQuestion && question.number === selectedQuestion.number) }">
                      <td>{{ question.number }}</td>
                      <td class="question-content">{{ question.content }}</td>
                      <td>{{ question.userAnswer }}</td>
                      <td>{{ question.correctAnswer }}</td>
                    </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>

          <div class="action-btn-container">
            <button
                type="submit"
                :disabled="isSubmitting || !selectedQuestion"
                class="submit-btn"
                @click="handleAnalyzeQuestion"
            >
              {{ isSubmitting ? '分析中...' : '分析选中题目' }}
            </button>
            <el-progress
                v-if="isSubmitting"
                :percentage="progress"
                :stroke-width="15"
                :text-inside="true"
                status="success"
                style="margin-top: 20px; width: 100%"
            />
          </div>
        </div>
      </div>
    </div>
  </div>
</template>

<script>
import SideBarMenu from '@/components/SideBarMenu.vue';
import { ElProgress } from 'element-plus';
import { getUserTestRecords} from '@/service/userTestRecordService'
import {  getQuestionsWithAnswers,  analyzeQuestion,  formatDateTime }
  from '@/service/questionService'

export default {
  name: 'QuestionAnalysis',
  components: {
    SideBarMenu,
    ElProgress
  },
  data() {
    return {
      userId: JSON.parse(localStorage.getItem('user') || '{}')?.id || '1',
      userTestRecords: [],
      questionsWithAnswers: [],
      selectedTestRecord: null,
      selectedQuestion: null,
      isSubmitting: false,
      progress: 0,
      progressInterval: null
    };
  },
  async created() {
    await this.loadUserTestRecords();
  },
  methods: {
    async loadUserTestRecords() {
      try {
        this.userTestRecords = await getUserTestRecords(this.userId);
        if (this.userTestRecords.length > 0) {
          await this.handleExamRecordSelect(this.userTestRecords[0]);
        }
      } catch (error) {
        console.error('加载考试记录失败:', error);
      }
    },

    async handleExamRecordSelect(record, event) {
      if (!record) return;

      this.selectedTestRecord = record;

      if (event) {
        const rows = document.querySelectorAll('#examRecordsTable tbody tr');
        rows.forEach(r => r.classList.remove('highlight'));
        event.currentTarget.classList.add('highlight');
      } else {
        this.$nextTick(() => {
          const firstRow = document.querySelector('#examRecordsTable tbody tr');
          if (firstRow) {
            firstRow.classList.add('highlight');
          }
        });
      }

      try {
        this.questionsWithAnswers = await getQuestionsWithAnswers(record.testId, this.userId);
        this.selectedQuestion = null;

        this.$nextTick(() => {
          const questionRows = document.querySelectorAll('#questionDetailsTable tbody tr');
          questionRows.forEach(r => r.classList.remove('highlight'));

          if (this.questionsWithAnswers.length > 0) {
            const firstQuestionRow = document.querySelector('#questionDetailsTable tbody tr');
            if (firstQuestionRow) {
              firstQuestionRow.classList.add('highlight');
              this.selectedQuestion = this.questionsWithAnswers[0];
            }
          }
        });
      } catch (error) {
        console.error('加载题目详情失败:', error);
      }
    },

    handleQuestionSelect(question, event) {
      this.selectedQuestion = question;
      const rows = document.querySelectorAll('#questionDetailsTable tbody tr');
      rows.forEach(r => r.classList.remove('highlight'));
      event.currentTarget.classList.add('highlight');
    },

    startProgress() {
      this.progress = 0;
      this.progressInterval = setInterval(() => {
        this.progress = Math.min(this.progress + 5, 90); // 最多到90%
      }, 1000);
    },

    stopProgress() {
      clearInterval(this.progressInterval);
      this.progress = 100;
      setTimeout(() => this.progress = 0, 1000);
    },

    async handleAnalyzeQuestion() {
      if (!this.selectedQuestion || !this.selectedTestRecord) return;

      this.isSubmitting = true;
      this.startProgress();

      try {
        const result = await analyzeQuestion(
            this.selectedTestRecord.testId,
            this.selectedQuestion.number,
            this.userId
        );

        this.$router.push({
          name: 'QuestionAnaResult',
          query: {
            analysisData: result.analysisResult,
            questionData: JSON.stringify({
              number: this.selectedQuestion.number,
              content: this.selectedQuestion.content,
              userAnswer: this.selectedQuestion.userAnswer,
              correctAnswer: this.selectedQuestion.correctAnswer,
              type: this.selectedQuestion.type,
              options: result.options,
            })
          }
        });
      } catch (error) {
        console.error('分析题目失败:', error);
        alert('分析题目失败，请稍后重试');
      } finally {
        this.stopProgress();
        this.isSubmitting = false;
      }
    },

    goBack() {
      this.$router.go(-1);
    },

    formatDateTime
  },
  beforeUnmount() {
    if (this.progressInterval) {
      clearInterval(this.progressInterval);
    }
  }
};
</script>

<style scoped>
/* Base layout styles */
.app-container {
  display: flex;
  min-height: 100vh;
}

.main-content {
  flex: 1;
  padding: 20px;
  background-color: #f5f5f5;
  margin-left: 250px;
  width: calc(100% - 250px);
}

.content {
  padding: 20px;
}

.card {
  background: white;
  border-radius: 8px;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  padding: 20px;
}

.header-container {
  display: flex;
  justify-content: center;
  align-items: center;
  margin-bottom: 20px;
  width: 100%;
}

.header {
  color: #333;
  margin-bottom: 20px;
  font-size: 24px;
  text-align: center;
}

/* Analysis container styles */
.analysis-container {
  display: flex;
  justify-content: space-between;
  margin-top: 20px;
  gap: 20px;
}

.analysis-section {
  position: relative;
  box-sizing: border-box;
}

.left-section {
  width: 35%; /* 左侧宽度减少40% */
}

.right-section {
  width: 65%; /* 右侧宽度增加40% */
}

.sticky-title {
  position: sticky;
  top: 0;
  left: 0;
  margin: 0;
  padding: 15px;
  background-color: #f8f9fa;
  border-bottom: 1px solid #dee2e6;
  color: #003366;
  z-index: 20;
  white-space: nowrap;
  box-sizing: border-box;
  width: 100%;
}

.record-list, .question-list {
  width: 100%;
  height: 400px;
  overflow: auto;
  border: 1px solid #ddd;
  background-color: #f0f8ff;
  border-radius: 4px;
  box-shadow: 0 1px 3px rgba(0,0,0,0.1);
  box-sizing: border-box;
}

.table-wrapper {
  overflow-x: auto;
  width: 100%;
}

/* Table styles */
table {
  width: 100%;
  border-collapse: collapse;
  font-size: 14px;
  table-layout: fixed;
}

thead tr {
  position: sticky;
  top: 0;
  z-index: 10;
  background-color: #f3e5ff !important;
  background-image: linear-gradient(to bottom, #f3e5ff, #e6d1f9);
  user-select: none;
}

thead th {
  padding: 12px 15px;
  text-align: left;
  background-color: #f8f9fa;
  color: #003366;
  font-weight: 600;
  border-bottom: 2px solid #d8bfd8;
  white-space: nowrap;
}

tbody tr {
  cursor: pointer;
  transition: background-color 0.2s;
}

tbody tr td {
  padding: 12px 15px;
  border-bottom: 1px solid #dee2e6;
  color: #333;
  overflow: hidden;
  text-overflow: ellipsis;
}

.question-content {
  white-space: normal; /* 允许换行 */
  word-break: break-word; /* 长单词换行 */
}

tbody tr.highlight {
  background-color: #e6f7ff !important;
  color: #003366 !important;
}

tbody tr:hover:not(.highlight) {
  background-color: #f8f9fa;
}

/* Button styles */
.action-btn-container {
  display: flex;
  flex-direction: column;
  justify-content: center;
  width: 100%;
  margin-top: 20px;
}

.submit-btn {
  background-color: #4CAF50;
  color: white;
  padding: 10px 20px;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  font-size: 16px;
  width: 100%;
}

.submit-btn:hover:not(:disabled) {
  background-color: #45a049;
}

.submit-btn:disabled {
  background-color: #cccccc;
  cursor: not-allowed;
}

/* Scrollbar styles */
.record-list::-webkit-scrollbar,
.question-list::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}

.record-list::-webkit-scrollbar-track,
.question-list::-webkit-scrollbar-track {
  background: #f1f1f1;
}

.record-list::-webkit-scrollbar-thumb,
.question-list::-webkit-scrollbar-thumb {
  background: #c1c1c1;
  border-radius: 4px;
}

.record-list::-webkit-scrollbar-thumb:hover,
.question-list::-webkit-scrollbar-thumb:hover {
  background: #a8a8a8;
}
</style>

上面是涉及的表和实体，实体不要动
请用Spring boot+MVC+MyBatis+vue Composition API的框架实现下面的功能
整个页面的布局参考上面的代码，左侧菜单的样式和大小不要动
右侧区域也是两个列表，左边列表显示系统的所有试卷，初次加载的时候高亮选中第一条，然后右侧列表显示这个试卷被哪些用户选中，从user_exam_paper中
查询，右侧列表不能点击
左侧列表的展示栏，包括试卷名称（examPaperName）,试卷内容（examPaperContent）,科目(examPaperSubject)，试卷难度(difficulty)
右侧列表展示，用户账户（userName） 用户真实姓名 userDetail.realName）用户所在大学（University）用户所在院系(Department) ,试卷测试数量（这个要从user_test_record
中统计分析，该试卷，该用户有过多少条记录）
