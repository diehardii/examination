生成试卷paper-gen.html
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>智能考试管理系统 - 试卷生成</title>
  <link rel="stylesheet" th:href="@{/css/menuStyle.css}">
</head>
<body>

<div th:replace="~{fragments/menu :: menu}"></div>

<div class="content">
  <div class="card">
    <h1 class="header">试卷生成</h1>

    <!-- 表单和图片容器 -->
    <div class="form-image-container">
      <!-- 左边：表单 -->
      <div class="form-section">
        <form th:action="@{/exam-paper/paper-gen}" method="post">
          试卷名称: <input type="text" name="name" required><br><br>
          <span class="hint">例如：C++期末卷，试卷名称不能重复</span><br><br>
          试卷内容: <input type="text" name="content" required><br><br>
          <span class="hint">请提出详细要求，例如：C++基础语法知识</span><br><br>
          难度:
          <select name="difficulty" required>
            <option value="">-- 请选择难度 --</option>
            <option value="简单">简单</option>
            <option value="中等">中等</option>
            <option value="困难">困难</option>
          </select><br><br>

          科目：
          <select id="subject" name="subject" class="select-control" required>
            <option value="">-- 请选择科目 --</option>
            <option th:each="subject : ${subjects}"
                    th:value="${subject.subjectName}"
                    th:text="${subject.subjectName}"></option>
          </select>

          <br><br><br>
          <input type="submit" value="生成试卷">

          <div th:if="${error}" class="error" th:text="${error}"></div>
          <div th:if="${success}" class="success" th:text="${success}"></div>
        </form>
      </div>

      <!-- 右边：图片 -->
      <div class="image-section">
        <img th:src="@{/images/test.jpg}" alt="试卷示意图">
      </div>
    </div>
  </div>
</div>
</body>
</html>
调用后端的控制器PaperGenController
package seucxxy.csd.backend.controller;



import jakarta.servlet.http.HttpSession;
import seucxxy.csd.backend.entity.ExamPaper;
import seucxxy.csd.backend.entity.Subject;
import seucxxy.csd.backend.entity.User;
import seucxxy.csd.backend.service.ExamPaperService;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.*;
import seucxxy.csd.backend.service.SubjectService;

import java.util.List;

@Controller
@RequestMapping("/exam-paper")
public class PaperGenController {
    private final ExamPaperService examPaperService;
    private final SubjectService subjectService;

    public PaperGenController(ExamPaperService examPaperService, SubjectService subjectService) {
        this.examPaperService = examPaperService;
        this.subjectService = subjectService;
    }

    @GetMapping("/paper-gen")
    public String showPaperGenForm(Model model, HttpSession session) {
        List<Subject> subjects = subjectService.getAllSubjects();
       System.out.println(subjects);
        User user = (User) session.getAttribute("user");
        model.addAttribute("subjects", subjects);
        model.addAttribute("user", user);
        return "/exam-paper/paper-gen";
    }

    @PostMapping("/paper-gen")
    public String generateExamPaper(@RequestParam String name,
                                    @RequestParam String content,
                                    @RequestParam String difficulty,
                                    @RequestParam String subject,
                                    HttpSession session,
                                    Model model) {

        User user = (User) session.getAttribute("user");
        model.addAttribute("user", user);
        try {
            ExamPaper paper = examPaperService.generateExamPaper(name, content, difficulty, subject);
            model.addAttribute("examPaper", paper);
            return "/exam-paper/paper-show";
        } catch (Exception e) {
            model.addAttribute("error", "生成试卷时出错: " + e.getMessage());
            return "/exam-paper/paper-gen";
        }
    }

    @GetMapping("/{id}")
    public String getExamPaper(@PathVariable Long id, Model model) {
        ExamPaper examPaper = examPaperService.getExamPaperById(id);
        model.addAttribute("examPaper", examPaper);
        return "exam-paper-detail";
    }
}
调用ExamPaperService
package seucxxy.csd.backend.service;

import seucxxy.csd.backend.entity.*;
import seucxxy.csd.backend.mapper.*;
import com.fasterxml.jackson.databind.JsonNode;
import com.fasterxml.jackson.databind.ObjectMapper;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.http.*;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;
import org.springframework.web.client.RestTemplate;

import java.util.ArrayList;
import java.util.List;

@Service
public class ExamPaperService {
    private final ExamPaperMapper examPaperMapper;
    private final QuestionMapper questionMapper;
    private final RestTemplate restTemplate;

   @Value("${coze.api.url}")
    private String cozeApiUrl;

    @Value("${coze.api.token.paper.gen}")
    private String cozeApiToken;

    public ExamPaperService(ExamPaperMapper examPaperMapper,
                            QuestionMapper questionMapper,
                            RestTemplate restTemplate) {
        this.examPaperMapper = examPaperMapper;
        this.questionMapper = questionMapper;
        this.restTemplate = restTemplate;
    }

    public ExamPaper getExamPaperById(Long id) {
        return examPaperMapper.findExamPaperById(id);
    }

    public ExamPaper getExamPaperByIdWithQuestions(Long id) {
        return examPaperMapper.findExamPaperByIdWithQuestions(id);
    }

    public List<ExamPaper> getAvailableExamPapers(String username) {
        return examPaperMapper.findAvailableExamPapers(username);
    }



    @Transactional
    public ExamPaper generateExamPaper(String name, String content, String difficulty, String subject) throws Exception {
        // 检查试卷名称是否已存在
        ExamPaper existingPaper = examPaperMapper.findExamPaperByName(name);
        if (existingPaper != null) {
            throw new Exception("试卷名称已存在");
        }

        // 构建请求到Coze API
        String requestBody = String.format("{\"workflow_id\": \"7504502289714069538\", \"parameters\": {\"content\": \"%s\", \"difficulty\": \"%s\"}}",
                content, difficulty);
        System.out.println(requestBody);

        HttpHeaders headers = new HttpHeaders();
        headers.setContentType(MediaType.APPLICATION_JSON);
        headers.set("Authorization", "Bearer " + cozeApiToken);

        HttpEntity<String> requestEntity = new HttpEntity<>(requestBody, headers);
        ResponseEntity<String> response = restTemplate.exchange(cozeApiUrl, HttpMethod.POST, requestEntity, String.class);

        // 解析响应
        ObjectMapper mapper = new ObjectMapper();
        JsonNode rootNode = mapper.readTree(response.getBody());
        String dataValue = rootNode.path("data").asText();
        JsonNode dataNode = mapper.readTree(dataValue);

        // 解析问题
        String questionsJson = dataNode.get("questions").asText();

        List<Question> questions = parseQuestions(questionsJson);

        // 创建并保存试卷
        ExamPaper examPaper = new ExamPaper();
        examPaper.setExamPaperName(name);
        examPaper.setExamPaperContent(content);
        examPaper.setExamPaperDifficulty(difficulty);
        examPaper.setExamPaperQuestionNumber(questions.size());
        examPaper.setExamPaperSubject(subject);

        examPaperMapper.insertExamPaper(examPaper);

        // 保存问题
        batchInsertQuestions(questions);

        examPaper.setQuestions(questions);
        return examPaper;
    }

       /**
         * 批量插入题目并打印每条记录
         * @param questions 题目列表（包含单选和判断）
         */
       public void batchInsertQuestions(List<Question> questions) {
            if (questions == null || questions.isEmpty()) {
                System.out.println("题目列表为空，无需插入");
                return;
            }

            int successCount = 0;

            for (Question question : questions) {
                try {


                    // 插入主表
                    int result = questionMapper.insertQuestion(question);

                    if (result > 0) {
                        successCount++;
                        // 根据不同类型打印不同信息
                        if (question.getQuestionType().equals("SINGLE_CHOICE") ) {
                            SingleChoiceQuestion scq = (SingleChoiceQuestion) question;
                            System.out.printf("成功插入单选题: ID=%d, 内容=%s, 选项A=%s, 正确答案=%s%n",
                                    question.getId(), question.getContent(),
                                    scq.getOptionA(), question.getCorrectAnswer());
                        } else if (question.getQuestionType().equals("JUDGE")) {
                            System.out.printf("成功插入判断题: ID=%d, 内容=%s, 正确答案=%s%n",
                                    question.getId(), question.getContent(),
                                    question.getCorrectAnswer());
                        }
                    } else {
                        System.out.println("插入失败: " + question.getContent());
                    }
                } catch (Exception e) {
                    System.out.println("插入题目异常: " + question.getContent() + ", 错误: " + e.getMessage());
                    e.printStackTrace();
                }
            }

            System.out.printf("插入完成! 成功插入%d条，共%d条%n", successCount, questions.size());
        }


    private List<Question> parseQuestions(String questionsJson) throws Exception {
        ObjectMapper mapper = new ObjectMapper();
        JsonNode questionsNode = mapper.readTree(questionsJson);
        List<Question> questions = new ArrayList<>();

        for (JsonNode questionNode : questionsNode) {

            String type = questionNode.path("type").asText();
            String content = questionNode.path("question").asText();
            int number = questionNode.path("number").asInt();

            if ("单选题".equals(type)) {
                SingleChoiceQuestion scq = new SingleChoiceQuestion();
                scq.setType(type);
                scq.setQuestionType("SINGLE_CHOICE");
                scq.setContent(content);
                scq.setNumber(number);
                scq.setOptionA(questionNode.path("optionA").asText());
                scq.setOptionB(questionNode.path("optionB").asText());
                scq.setOptionC(questionNode.path("optionC").asText());
                scq.setOptionD(questionNode.path("optionD").asText());
                scq.setCorrectAnswer(questionNode.path("correctAnswer").asText());

                questions.add(scq);
            } else if ("是非题".equals(type)) {
                JudgeQuestion jq = new JudgeQuestion();
                jq.setType(type);
                jq.setQuestionType("JUDGE");
                jq.setContent(content);
                jq.setNumber(number);
                jq.setCorrectAnswer(questionNode.path("correctAnswer").asText());
                questions.add(jq);
            }
        }
        System.out.println(questions.toString());
        return questions;

    }

}
返回生成后的试卷，展示页面
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>试卷详情</title>
  <link rel="stylesheet" th:href="@{/css/menuStyle.css}">
  <style>
    .button-container {
      margin-top: 20px;
      text-align: center;
    }

    input[type="button"] {
      background-color: #28a745;
      border: none;
      color: white;
      padding: 10px 20px;
      text-align: center;
      text-decoration: none;
      display: inline-block;
      font-size: 16px;
      margin: 4px 2px;
      cursor: pointer;
      border-radius: 4px;
      transition-duration: 0.4s;
    }

    input[type="button"]:hover {
      background-color: white;
      color: black;
      border: 2px solid #28a745;
    }
  </style>
</head>
<body>

<div th:replace="~{fragments/menu :: menu}"></div>

<div class="content">
  <div class="card">
    <h1 class="header" th:text="${examPaper.examPaperName}"></h1>

    <div class="paper-info">
      <p><strong>科目：</strong><span th:text="${examPaper.examPaperSubject}"></span></p>
      <p><strong>难度：</strong><span th:text="${examPaper.examPaperDifficulty}"></span></p>
      <p><strong>题目数量：</strong><span th:text="${examPaper.examPaperQuestionNumber}"></span></p>
      <p><strong>内容要求：</strong><span th:text="${examPaper.examPaperContent}"></span></p>
    </div>

    <div class="questions" th:each="question, iterStat : ${examPaper.questions}">
      <div class="question">
        <p th:text="${iterStat.count} + '. ' + ${question.content}"></p>

        <div th:if="${question.getQuestionType() == 'SINGLE_CHOICE'}">
          <p>A. <span th:text="${question.optionA}"></span></p>
          <p>B. <span th:text="${question.optionB}"></span></p>
          <p>C. <span th:text="${question.optionC}"></span></p>
          <p>D. <span th:text="${question.optionD}"></span></p>
          <p><strong>正确答案：</strong><span th:text="${question.correctAnswer}"></span></p>
        </div>

        <div th:if="${question.getQuestionType() == 'JUDGE'}">
          <p><strong>正确答案：</strong>
            <span th:text="${question.correctAnswer}? '正确' : '错误'"></span>
          </p>
        </div>
      </div>
    </div>
  </div>
  <div class="button-container">
    <input type="button" value="返回" onclick="window.history.back();">
  </div>
</div>

</body>
</html>
用到的实体类Entity如下：
package seucxxy.csd.backend.entity;



import java.util.List;

public class ExamPaper {
    private Long id;
    private String examPaperName;
    private String examPaperContent;
    private String examPaperDifficulty;
    private int examPaperQuestionNumber;
    private String examPaperSubject;
    private List<Question> questions;

    // Getters and Setters
    public Long getId() {
        return id;
    }

    public void setId(Long id) {
        this.id = id;
    }

    public String getExamPaperName() {
        return examPaperName;
    }

    public void setExamPaperName(String examPaperName) {
        this.examPaperName = examPaperName;
    }

    public String getExamPaperContent() {
        return examPaperContent;
    }

    public void setExamPaperContent(String examPaperContent) {
        this.examPaperContent = examPaperContent;
    }

    public String getExamPaperDifficulty() {
        return examPaperDifficulty;
    }

    public void setExamPaperDifficulty(String examPaperDifficulty) {
        this.examPaperDifficulty = examPaperDifficulty;
    }

    public int getExamPaperQuestionNumber() {
        return examPaperQuestionNumber;
    }

    public void setExamPaperQuestionNumber(int examPaperQuestionNumber) {
        this.examPaperQuestionNumber = examPaperQuestionNumber;
    }

    public String getExamPaperSubject() {
        return examPaperSubject;
    }

    public void setExamPaperSubject(String examPaperSubject) {
        this.examPaperSubject = examPaperSubject;
    }

    public List<Question> getQuestions() {
        return questions;
    }

    public void setQuestions(List<Question> questions) {
        this.questions = questions;
    }
}
package seucxxy.csd.backend.entity;



public class Question {
    private Long id;
    private String questionType; // 新增字段，对应数据库question_type
    private String type;
    private String content;
    private int number;
    private Long examPaperId;
    private String correctAnswer; // 移动到基类

    // Getters and Setters
    // 添加questionType的getter/setter
    public String getQuestionType() {
        return questionType;
    }

    public void setQuestionType(String questionType) {
        this.questionType = questionType;
    }

    // Getters and Setters
    public Long getId() {
        return id;
    }

    public void setId(Long id) {
        this.id = id;
    }

    public String getType() {
        return type;
    }

    public void setType(String type) {
        this.type = type;
    }

    public String getContent() {
        return content;
    }

    public void setContent(String content) {
        this.content = content;
    }

    public int getNumber() {
        return number;
    }

    public void setNumber(int number) {
        this.number = number;
    }

    public Long getExamPaperId() {
        return examPaperId;
    }

    public void setExamPaperId(Long examPaperId) {
        this.examPaperId = examPaperId;
    }


    public String getCorrectAnswer() {
        return correctAnswer;
    }

    public void setCorrectAnswer(String correctAnswer) {
        this.correctAnswer = correctAnswer;
    }
}
package seucxxy.csd.backend.entity;



public class SingleChoiceQuestion extends Question {
    private String optionA;
    private String optionB;
    private String optionC;
    private String optionD;


    // Getters and Setters
    public String getOptionA() {
        return optionA;
    }

    public void setOptionA(String optionA) {
        this.optionA = optionA;
    }

    public String getOptionB() {
        return optionB;
    }

    public void setOptionB(String optionB) {
        this.optionB = optionB;
    }

    public String getOptionC() {
        return optionC;
    }

    public void setOptionC(String optionC) {
        this.optionC = optionC;
    }

    public String getOptionD() {
        return optionD;
    }

    public void setOptionD(String optionD) {
      this.optionD = optionD;
    }

}


package seucxxy.csd.backend.entity;



public class JudgeQuestion extends Question {



}
package seucxxy.csd.backend.entity;


public class Subject {
    private int subjectId;
    private String subjectName;

    // Getters and Setters
    public Subject(String subjectName) {
        this.subjectName = subjectName;
    }

    public int getSubjectId() {
        return subjectId;
    }

    public void setSubjectId(int subjectId) {
        this.subjectId = subjectId;
    }

    public String getSubjectName() {
        return subjectName;
    }

    public void setSubjectName(String subjectName) {
        this.subjectName = subjectName;
    }
}
请将上述代码的功能用Spring boot +MVC+Mybatis+Vue重构，注意界面不要动，实体类不要动，后端的service尽量不要动，给出完整的实现代码
  


